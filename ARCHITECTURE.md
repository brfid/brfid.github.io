# Architecture (Beginner-Friendly)

Canonical companion docs:
- `README.md` (how it works + quickstart)
- `WORKFLOWS.md` (CI/test/publish behavior)
- `arpanet/README.md` (ARPANET runtime topology/ops)
- `docs/transport-archive.md` (retained transport history)

This project turns a single source resume (`resume.yaml`) into a small static website
that includes:

- A standard resume page (HTML + PDF)
- A manpage-style summary generated by a tiny C program
- A muted build transcript as a “quiet technical signal”

If you are new to the repo, start with the **Overview** and the **Pipeline** diagram.

---

## Overview (TL;DR)

1. **Input:** `resume.yaml`
2. **Host build:** Python generates HTML, PDF, and YAML for VAX.
3. **VAX step:** A C program (`vax/bradman.c`) runs (locally or in 4.3BSD VAX emulator) to create `brad.1`.
4. **Host render:** `brad.1` is rendered into `site/brad.man.txt`.
5. **Output:** Everything ends up in `site/` for static hosting.

**Current enhancement (2026-02-13):** Upgrading VAX C parser to handle standard YAML, removing Python preprocessing dependency. See `docs/YAML-ENHANCEMENT-PLAN.md`.

---

## Pipeline (Diagram)

```mermaid
flowchart LR
  A[resume.yaml] --> B[Host Python: resume-gen]
  B --> C[site/resume/ (HTML)]
  B --> D[site/resume.pdf]
  B --> E[build/vax/resume.vax.yaml]

  E --> F[VAX step (bradman.c)]
  F --> G[build/vax/brad.1]
  G --> H[Host render brad.1 -> brad.man.txt]

  H --> I[site/brad.man.txt]
  B --> J[site/vax-build.log]
  C --> K[site/index.html]
  I --> K
  J --> K
```

---

## Core Components

**1) Host generator (Python)**
- Entry point: `resume-gen` (see `resume_generator/cli.py`)
- Reads `resume.yaml`, generates HTML/PDF, and prepares `resume.vax.yaml`.
- Renders `brad.1` into `site/brad.man.txt` for the landing page.

**2) VAX generator (C)**
- Source: `vax/bradman.c`
- Reads `resume.vax.yaml`, produces a roff manpage (`brad.1`).
- Designed for 4.3BSD/K&R C compatibility.

**3) VAX stage runner**
- `resume_generator/vax_stage.py`
- Modes:
  - **local:** compile and run `bradman.c` on the host (fast, no emulator).
  - **docker:** run 4.3BSD in SIMH and compile/run inside the emulator.
  - **transcript:** replay a saved console transcript.
- Docker mode uses **tape by default** to pass files into the guest.

**4) YAML Processing (Current: v1, Planned: v2)**

**v1 (Current):**
- Python preprocessor (`vax_yaml.py`) converts `resume.yaml` → constrained `resume.vax.yaml`
- VAX C parser handles only quoted strings, simple structure
- Works but adds Python dependency

**v2 (In Development):**
- Enhanced VAX C parser handles standard YAML (unquoted strings, lists, nested maps)
- Direct parsing of `resume.yaml` without preprocessing
- 95% YAML coverage (excludes comments, anchors, complex multiline)
- See: `docs/YAML-ENHANCEMENT-PLAN.md`

**ARPANET Components (Archived):**
- ARPANET Phase 2 (IMPs + multi-hop) removed from CI as of 2026-02-13
- Tape transfer validated and archived: `docs/integration/TAPE-TRANSFER-VALIDATION-2026-02-13.md`
- Can be restored for demonstrations but not needed for builds

---

## Data Formats

**Input**
- `resume.yaml` (human-edited)

**Derived**
- `build/vax/resume.vax.yaml` (simple YAML subset for the VAX C parser)
- `build/vax/brad.1` (roff manpage source)
- `site/brad.man.txt` (rendered manpage summary)
- `site/vax-build.log` (muted transcript)

---

## Runtime Modes

**Local mode** (fast iteration):
```bash
.venv/bin/resume-gen --out site --with-vax --vax-mode local
```
- Compiles `bradman.c` on host
- No emulator needed
- Fast (~5 seconds)

**Docker (SIMH) mode** (authentic 4.3BSD):
```bash
.venv/bin/resume-gen --out site --with-vax --vax-mode docker
```
- Runs VAX 11/780 emulator
- 4.3BSD UNIX (1986)
- K&R C compiler
- TS11 tape transfer
- Authentic but slower (~60 seconds)

**GitHub Actions Tags:**
- `publish` or `publish-*`: Local mode (fast)
- `publish-vax` or `publish-docker`: Docker mode (authentic)

**Notes:**
- Docker mode uses pinned SIMH image (`jguillaumes/simh-vaxbsd`)
- File transfer via TS11 tape image
- ARPANET multi-hop removed from CI (archived)
- Historical ARPANET work: `docs/integration/TAPE-TRANSFER-VALIDATION-2026-02-13.md`

## Retained implementation records

In-progress and historical implementation records are intentionally retained, especially under
`arpanet/` (for example `PHASE2-PLAN.md`, `PHASE3-IMPLEMENTATION-PLAN.md`, and
`PHASE3-PROGRESS.md`).

---

## Outputs

**Published (in `site/`)**
- `site/index.html`
- `site/resume/`
- `site/resume.pdf`
- `site/brad.man.txt`
- `site/vax-build.log`
- `site/arpanet-transfer.log` (when `--with-arpanet` is enabled)

**Internal (in `build/`)**
- `build/vax/resume.vax.yaml`
- `build/vax/brad.1`
- `build/vax/arpanet-transfer-exec.log` (execute mode scaffold output)

---

## CI/Publish Behavior

- `main` branch: runs checks only (no deploy).
- `publish` / `publish-*` tags: run full build + deploy to GitHub Pages.

---

## Where to Look Next

- `README.md` for quickstart commands.
- `PLAN.md` for project status and next steps.
- `resume_generator/` for pipeline implementation.
