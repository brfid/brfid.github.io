# Architecture (Beginner-Friendly)

Canonical companion docs:
- `README.md` (how it works + quickstart)
- `WORKFLOWS.md` (CI/test/publish behavior)
- `arpanet/README.md` (ARPANET runtime topology/ops)
- `docs/transport-archive.md` (retained transport history)

This project turns a single source resume (`resume.yaml`) into a small static website
that includes:

- A standard resume page (HTML + PDF)
- A manpage-style summary generated by a tiny C program
- A muted build transcript as a “quiet technical signal”

If you are new to the repo, start with the **Overview** and the **Pipeline** diagram.

---

## Overview (TL;DR)

1. **Input:** `resume.yaml`
2. **Host build:** Python generates HTML, PDF, and a simplified YAML for the VAX program.
3. **VAX step:** A C program (`vax/bradman.c`) runs (locally or inside a VAX emulator) to create `brad.1`.
4. **Host render:** `brad.1` is rendered into `site/brad.man.txt`.
5. **Output:** Everything ends up in `site/` for static hosting.

---

## Pipeline (Diagram)

```mermaid
flowchart LR
  A[resume.yaml] --> B[Host Python: resume-gen]
  B --> C[site/resume/ (HTML)]
  B --> D[site/resume.pdf]
  B --> E[build/vax/resume.vax.yaml]

  E --> F[VAX step (bradman.c)]
  F --> G[build/vax/brad.1]
  G --> H[Host render brad.1 -> brad.man.txt]

  H --> I[site/brad.man.txt]
  B --> J[site/vax-build.log]
  C --> K[site/index.html]
  I --> K
  J --> K
```

---

## Core Components

**1) Host generator (Python)**
- Entry point: `resume-gen` (see `resume_generator/cli.py`)
- Reads `resume.yaml`, generates HTML/PDF, and prepares `resume.vax.yaml`.
- Renders `brad.1` into `site/brad.man.txt` for the landing page.

**2) VAX generator (C)**
- Source: `vax/bradman.c`
- Reads `resume.vax.yaml`, produces a roff manpage (`brad.1`).
- Designed for 4.3BSD/K&R C compatibility.

**3) VAX stage runner**
- `resume_generator/vax_stage.py`
- Modes:
  - **local:** compile and run `bradman.c` on the host (fast, no emulator).
  - **docker:** run 4.3BSD in SIMH and compile/run inside the emulator.
  - **transcript:** replay a saved console transcript.
- Docker mode uses **tape by default** to pass files into the guest.

**4) ARPANET stage wrapper (Phase 3 scaffold)**
- `resume_generator/vax_arpanet_stage.py`
- Activated through CLI flags:
  - `--with-arpanet` (dry-run scaffold by default)
  - `--arpanet-execute` (explicit command execution mode)
- Current behavior:
  - wraps the normal VAX stage
  - emits `site/arpanet-transfer.log`
  - in execute mode, runs scaffold command hooks and captures transfer execution output to
    `build/vax/arpanet-transfer-exec.log`
  - execute mode includes initial resiliency controls:
    - retries transfer `docker exec` once on command failure
    - classifies transfer output (`ok`, `empty-output`, `fatal-marker-detected`)
    - records attempt + validation breadcrumbs in `site/arpanet-transfer.log`

---

## Data Formats

**Input**
- `resume.yaml` (human-edited)

**Derived**
- `build/vax/resume.vax.yaml` (simple YAML subset for the VAX C parser)
- `build/vax/brad.1` (roff manpage source)
- `site/brad.man.txt` (rendered manpage summary)
- `site/vax-build.log` (muted transcript)

---

## Runtime Modes

**Local mode**
```
.venv/bin/resume-gen --out site --with-vax --vax-mode local
```

**Docker (SIMH) mode**
```
.venv/bin/resume-gen --out site --with-vax --vax-mode docker
```

**ARPANET scaffold (dry-run)**
```
.venv/bin/resume-gen --out site --with-vax --with-arpanet --vax-mode local
```

**ARPANET scaffold (execute mode)**
```
.venv/bin/resume-gen --out site --with-vax --with-arpanet --arpanet-execute --vax-mode local
```

Notes:
- Docker mode runs a pinned SIMH image.
- File transfer uses a TS11 tape image.
- Console/FTP transports are not part of the active runtime path.
- Historical transport notes are retained in `docs/transport-archive.md`.

## Retained implementation records

In-progress and historical implementation records are intentionally retained, especially under
`arpanet/` (for example `PHASE2-PLAN.md`, `PHASE3-IMPLEMENTATION-PLAN.md`, and
`PHASE3-PROGRESS.md`).

---

## Outputs

**Published (in `site/`)**
- `site/index.html`
- `site/resume/`
- `site/resume.pdf`
- `site/brad.man.txt`
- `site/vax-build.log`
- `site/arpanet-transfer.log` (when `--with-arpanet` is enabled)

**Internal (in `build/`)**
- `build/vax/resume.vax.yaml`
- `build/vax/brad.1`
- `build/vax/arpanet-transfer-exec.log` (execute mode scaffold output)

---

## CI/Publish Behavior

- `main` branch: runs checks only (no deploy).
- `publish` / `publish-*` tags: run full build + deploy to GitHub Pages.

---

## Where to Look Next

- `README.md` for quickstart commands.
- `PLAN.md` for project status and next steps.
- `resume_generator/` for pipeline implementation.
